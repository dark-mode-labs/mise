{% assign s = section.settings %}

{% capture section_spacing_style %}
  {% if s.padding_vertical == 'custom' %}
    padding-top: {{ s.padding_vertical_custom }}px;
    padding-bottom: {{ s.padding_vertical_custom }}px;
  {% endif %}
  {% if s.padding_horizontal == 'custom' %}
     padding-left: {{ s.padding_horizontal_custom }}px;
     padding-right: {{ s.padding_horizontal_custom }}px;
  {% endif %}
  {% if s.height == 'custom' %}--max-h: {{ s.height_custom }}px;{% endif %}
{% endcapture %}

{% capture section_spacing_class %}
  {% unless s.padding_vertical == 'custom' %}section-py-{{ s.padding_vertical }}{% endunless %}
  {% unless s.padding_horizontal == 'custom' %}section-px-{{ s.padding_horizontal }}{% endunless %}
{% endcapture %}

{% case s.columns_desktop %}
  {% when 2 %}
    {% assign grid_class = 'lg:grid-cols-2' %}
  {% when 3 %}
    {% assign grid_class = 'lg:grid-cols-3' %}
  {% when 4 %}
    {% assign grid_class = 'lg:grid-cols-4' %}
{% endcase %}

{% case s.columns_mobile %}
  {% when 2 %}
    {% assign mobile_grid_class = 'md:grid-cols-2' %}
{% endcase %}

{% assign animation_class = '' %}
{% if s.enable_animation %}
  {% assign animation_class = 'stagger-load' %}
{% endif %}

{% if s.overlay_color != blank %}
  {% capture overlay_style %}
    {% if s.enable_gradient %}
      background: linear-gradient(to top, {{ s.overlay_color }} 0%, transparent 100%);
    {% else %}
      background-color: {{ s.overlay_color }};
    {% endif %}
    opacity: {{ s.overlay_opacity | divided_by: 100.0 }};
  {% endcapture %}
{% endif %}

<section class="section-multi-column relative color-{{ s.color_scheme }}">
  <div
    class="grid-layout-overlay bg-body width-{{ s.width_scheme }} limit-width {{ section_spacing_class }} is-{{ s.height }}"
    style="{{ section_spacing_style }}"
  >
    {% if s.bg_image != blank %}
      <div class="grid-media-overlay overflow-hidden bg-surface">
        <div class="grid-media-inner">
          {% render 'media', src: s.bg_image, src_mobile: s.bg_image_mobile, fit: 'cover', loading: 'lazy' %}
          <div
            class="absolute inset-0 pointer-events-none"
            style="{{ overlay_style }}"
          ></div>
        </div>
      </div>
    {% endif %}

    <div class="grid-content-overlay">
      {% if s.heading != blank %}
        <div class=" text-body text-center mx-auto mb-4 animate-fade-up">
          {% render 'typography', text: s.heading, tag: 'h2', size: 'h2' %}
        </div>
      {% endif %}

      <div
        class="grid grid-cols-1 {{ mobile_grid_class }} {{ grid_class }} {{ animation_class }} grid-gap-y-{{ s.card_padding }}"
        style="{% if s.card_padding == 'custom' %}--grid-gap-y: {{ s.card_padding_custom }}px;{% endif %}"
      >
        {% content_for 'blocks' %}
      </div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Grid",
  "settings": [
    { "type": "header", "content": "Content" },
    { "type": "text", "id": "heading", "label": "Section Heading", "default": "Our Process" },
    { "type": "image_picker", "id": "bg_image", "label": "Background Image" },
    { "type": "image_picker", "id": "bg_image_mobile", "label": "Mobile Background" },

    { "type": "header", "content": "Overlay", "conditional": "setting.bg_image != blank" },
    {
      "type": "checkbox",
      "id": "enable_gradient",
      "label": "Use Gradient Overlay",
      "default": false,
      "conditional": "setting.bg_image != blank"
    },
    {
      "type": "color",
      "id": "overlay_color",
      "label": "Tint Color",
      "default": "",
      "conditional": "setting.bg_image != blank"
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "label": "Opacity",
      "min": 0,
      "max": 100,
      "default": 40,
      "conditional": "setting.bg_image != blank"
    },
    { "type": "header", "content": "Layout" },
    {
      "type": "width_scheme",
      "id": "width_scheme",
      "label": "Max Content Width",
      "default": "standard"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "label": "Columns per row",
      "min": 2,
      "max": 4,
      "default": 3
    },
    {
      "type": "range",
      "id": "columns_mobile",
      "label": "Columns per row (Mobile)",
      "min": 1,
      "max": 2,
      "default": 2
    },

    { "type": "header", "content": "Spacing" },
    {
      "type": "select",
      "id": "height",
      "label": "Section Height",
      "options": [
        { "value": "auto", "label": "Auto (Fit Content)" },
        { "value": "sm", "label": "Small" },
        { "value": "md", "label": "Medium" },
        { "value": "lg", "label": "Large" },
        { "value": "xl", "label": "Fullscreen" },
        { "value": "custom", "label": "Custom" }
      ],
      "default": "auto"
    },
    {
      "type": "range",
      "id": "height_custom",
      "label": "Custom Height",
      "min": 200,
      "max": 1000,
      "step": 10,
      "default": 400,
      "unit": "px",
      "conditional": "setting.height == 'custom'"
    },
    {
      "type": "select",
      "id": "padding_vertical",
      "label": "Vertical Padding",
      "options": [
        { "value": "none", "label": "None" },
        { "value": "xs", "label": "Extra Small" },
        { "value": "sm", "label": "Small" },
        { "value": "md", "label": "Medium" },
        { "value": "lg", "label": "Large" },
        { "value": "xl", "label": "Extra Large" },
        { "value": "custom", "label": "Custom" }
      ],
      "default": "none"
    },
    {
      "type": "range",
      "id": "padding_vertical_custom",
      "label": "Custom Vertical Padding",
      "min": 0,
      "max": 200,
      "step": 4,
      "default": 80,
      "unit": "px",
      "conditional": "setting.padding_vertical == 'custom'"
    },
    {
      "type": "select",
      "id": "padding_horizontal",
      "label": "Horizontal Padding",
      "options": [
        { "value": "none", "label": "None" },
        { "value": "xs", "label": "Extra Small" },
        { "value": "sm", "label": "Small" },
        { "value": "md", "label": "Medium" },
        { "value": "lg", "label": "Large" },
        { "value": "xl", "label": "Extra Large" },
        { "value": "custom", "label": "Custom" }
      ],
      "default": "none"
    },
    {
      "type": "range",
      "id": "padding_horizontal_custom",
      "label": "Custom Horizontal Padding",
      "min": 0,
      "max": 200,
      "step": 4,
      "default": 0,
      "unit": "px",
      "conditional": "setting.padding_horizontal == 'custom'"
    },

    { "type": "header", "content": "Theme" },
    { "type": "checkbox", "id": "enable_animation", "label": "Enable Animation", "default": true },
    { "type": "color_scheme", "id": "color_scheme", "label": "Color Palette", "default": "default" },

    { "type": "header", "content": "Cards" },
    { "type": "checkbox", "id": "enable_cards_global", "label": "Enable Cards for All Columns", "default": false },
    { "type": "header", "content": "Card Style", "conditional": "setting.enable_cards_global == true" },
    {
      "type": "select",
      "id": "card_padding",
      "label": "Card Padding",
      "options": [
        { "value": "none", "label": "None" },
        { "value": "xs", "label": "Extra Small" },
        { "value": "sm", "label": "Small" },
        { "value": "md", "label": "Medium" },
        { "value": "lg", "label": "Large" },
        { "value": "custom", "label": "Custom" }
      ],
      "default": "md",
      "conditional": "setting.enable_cards_global == true"
    },
    {
      "type": "range",
      "id": "card_padding_custom",
      "label": "Custom Card Padding",
      "min": 0,
      "max": 100,
      "step": 4,
      "default": 24,
      "conditional": "setting.card_padding == 'custom'"
    },
    {
      "type": "checkbox",
      "id": "card_shadow_global",
      "label": "Show Shadow",
      "default": false,
      "conditional": "setting.enable_cards_global == true"
    }
  ],
  "blocks": [{ "type": "_column" }],
  "presets": [
    {
      "name": "Multi-Column",
      "settings": { "columns_desktop": 3 },
      "blocks": {
        "col_1": {
          "type": "_column",
          "blocks": { "title": { "type": "heading", "settings": { "text": "Sourcing" } } },
          "block_order": ["title"]
        },
        "col_2": {
          "type": "_column",
          "blocks": { "title": { "type": "heading", "settings": { "text": "Prep" } } },
          "block_order": ["title"]
        },
        "col_3": {
          "type": "_column",
          "blocks": { "title": { "type": "heading", "settings": { "text": "Plating" } } },
          "block_order": ["title"]
        }
      },
      "block_order": ["col_1", "col_2", "col_3"]
    }
  ]
}
{% endschema %}
