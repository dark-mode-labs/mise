{% assign s = section.settings %}

{% case s.columns_desktop %}
  {% when 2 %}
    {% assign grid_class = 'lg:grid-cols-2' %}
  {% when 3 %}
    {% assign grid_class = 'lg:grid-cols-3' %}
  {% when 4 %}
    {% assign grid_class = 'lg:grid-cols-4' %}
{% endcase %}

{% case s.columns_mobile %}
  {% when 2 %}
    {% assign mobile_grid_class = 'md:grid-cols-2' %}
{% endcase %}

{% assign animation_class = '' %}
{% if s.enable_animation %}
  {% assign animation_class = 'stagger-load' %}
{% endif %}

{% assign body_color = 'bg-body' %}
{% unless s.bg_image == blank %}
  {% assign body_color = '' %}
{% endunless %}

{% if s.overlay_color != blank %}
  {% capture overlay_style %}
    {% if s.enable_gradient %}
      background: linear-gradient(to top, {{ s.overlay_color }} 0%, transparent 100%);
    {% else %}
      background-color: {{ s.overlay_color }};
    {% endif %}
    opacity: {{ s.overlay_opacity | divided_by: 100.0 }};
  {% endcapture %}
{% endif %}

<section
  class="section-multi-column relative color-{{ s.color_scheme }} width-{{ s.width_scheme }} pt-[var(--pt)] pb-[var(--pb)] px-[var(--px)] limit-width {{ body_color }}"
  style="--pt: {{ s.padding_top }}px; --pb: {{ s.padding_bottom }}px; --px: {{ s.padding_horizontal }}px;"
>
  {% if s.bg_image != blank %}
    <div class="absolute inset-0 -z-10 w-full h-full overflow-hidden bg-surface">
      <div class="relative w-full h-full">
        {% render 'media', src: s.bg_image, src_mobile: s.bg_image_mobile, fit: 'cover', loading: 'lazy' %}
        <div
          class="absolute inset-0 pointer-events-none"
          style="{{ overlay_style }}"
        ></div>
      </div>
    </div>
  {% endif %}

  <div class="w-full flex flex-col">
    {% if s.heading != blank %}
      <div class="w-full text-center mx-auto mb-4 animate-fade-up">
        {% render 'typography', text: s.heading, tag: 'h2', size: 'h2' %}
      </div>
    {% endif %}

    <div
      class="grid grid-cols-1 {{ mobile_grid_class }} {{ grid_class }} gap-gap gap-y-12 {{ animation_class }}"
      style="padding: {{ s.card_padding_global }}px;"
    >
      {% content_for 'blocks' %}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Grid",
  "settings": [
    { "type": "header", "content": "Content" },
    { "type": "text", "id": "heading", "label": "Section Heading", "default": "Our Process" },
    { "type": "image_picker", "id": "bg_image", "label": "Background Image" },
    { "type": "image_picker", "id": "bg_image_mobile", "label": "Mobile Background" },

    { "type": "header", "content": "Overlay", "conditional": "setting.bg_image != blank" },
    {
      "type": "checkbox",
      "id": "enable_gradient",
      "label": "Use Gradient Overlay",
      "default": false,
      "conditional": "setting.bg_image != blank"
    },
    {
      "type": "color",
      "id": "overlay_color",
      "label": "Tint Color",
      "default": "",
      "conditional": "setting.bg_image != blank"
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "label": "Opacity",
      "min": 0,
      "max": 100,
      "default": 40,
      "conditional": "setting.bg_image != blank"
    },
    { "type": "header", "content": "Layout" },
    {
      "type": "width_scheme",
      "id": "width_scheme",
      "label": "Max Content Width",
      "default": "standard"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "label": "Columns per row",
      "min": 2,
      "max": 4,
      "default": 3
    },
    {
      "type": "range",
      "id": "columns_mobile",
      "label": "Columns per row (Mobile)",
      "min": 1,
      "max": 2,
      "default": 2
    },

    { "type": "header", "content": "Spacing" },
    { "type": "range", "id": "padding_top", "label": "Padding Top", "min": 0, "max": 160, "step": 4, "default": 96 },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Padding Bottom",
      "min": 0,
      "max": 160,
      "step": 4,
      "default": 96
    },
    {
      "type": "range",
      "id": "padding_horizontal",
      "label": "Padding Horizontal (L/R)",
      "min": 0,
      "max": 80,
      "step": 4,
      "default": 0,
      "unit": "px"
    },

    { "type": "header", "content": "Theme" },
    { "type": "checkbox", "id": "enable_animation", "label": "Enable Animation", "default": true },
    { "type": "color_scheme", "id": "color_scheme", "label": "Color Palette", "default": "default" },

    { "type": "header", "content": "Cards" },
    { "type": "checkbox", "id": "enable_cards_global", "label": "Enable Cards for All Columns", "default": false },
    { "type": "header", "content": "Card Style", "conditional": "setting.enable_cards_global == true" },
    {
      "type": "range",
      "id": "card_padding_global",
      "label": "Card Padding",
      "min": 0,
      "max": 60,
      "step": 4,
      "default": 24,
      "conditional": "setting.enable_cards_global == true"
    },
    {
      "type": "checkbox",
      "id": "card_shadow_global",
      "label": "Show Shadow",
      "default": false,
      "conditional": "setting.enable_cards_global == true"
    }
  ],
  "blocks": [{ "type": "_column" }],
  "presets": [
    {
      "name": "Multi-Column",
      "settings": { "columns_desktop": 3 },
      "blocks": {
        "col_1": {
          "type": "_column",
          "blocks": { "title": { "type": "heading", "settings": { "text": "Sourcing" } } },
          "block_order": ["title"]
        },
        "col_2": {
          "type": "_column",
          "blocks": { "title": { "type": "heading", "settings": { "text": "Prep" } } },
          "block_order": ["title"]
        },
        "col_3": {
          "type": "_column",
          "blocks": { "title": { "type": "heading", "settings": { "text": "Plating" } } },
          "block_order": ["title"]
        }
      },
      "block_order": ["col_1", "col_2", "col_3"]
    }
  ]
}
{% endschema %}
