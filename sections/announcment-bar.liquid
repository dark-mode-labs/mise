{% assign s = section.settings %}

<div
  class="section-announcement color-{{ s.color_scheme }} width-{{ s.width_scheme }} text-body bg-body relative z-header-top text-xs md:text-sm font-bold tracking-wide uppercase group select-none border-b border-std limit-width"
  data-behavior="slideshow"
  data-autoplay="{{ s.autoplay }}"
  data-speed="{{ s.autoplay_speed }}"
  data-infinite="true"
>
  <div class="slideshow-track flex w-full overflow-x-auto snap-x snap-mandatory scroll-smooth scrollbar-hide cursor-grab active:cursor-grabbing">
    {% content_for 'blocks' %}
  </div>

  {% if section.blocks.size > 1 and s.show_arrows %}
    <div class="absolute inset-0 pointer-events-none flex items-center justify-between px-4 opacity-0 group-hover:opacity-100 transition-opacity">
      <button type="button" class="slideshow-prev pointer-events-auto p-1 btn-nav" aria-label="Previous">
        {% render 'icon', name: 'chevron-left', class: 'w-3 h-3' %}
      </button>
      <button type="button" class="slideshow-next pointer-events-auto p-1 btn-nav" aria-label="Next">
        {% render 'icon', name: 'chevron-right', class: 'w-3 h-3' %}
      </button>
    </div>
  {% endif %}

  {% if s.show_close %}
    <button
      type="button"
      class="absolute right-2 top-1/2 -translate-y-1/2 p-2 hover:opacity-60 z-floating"
      onclick="this.closest('.section-announcement').remove()"
      aria-label="Dismiss"
    >
      {% render 'icon', name: 'close', class: 'w-3 h-3' %}
    </button>
  {% endif %}
</div>

{% schema %}
{
  "name": "Announcement Bar",
  "class": "section-group-header",
  "restriction": { "groups": ["header"] },
  "settings": [
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "width_scheme",
      "id": "width_scheme",
      "label": "Max Content Width",
      "default": "full"
    },
    {
      "type": "header",
      "content": "Behavior"
    },
    { "type": "checkbox", "id": "autoplay", "label": "Autoplay", "default": true },
    { "type": "range", "id": "autoplay_speed", "label": "Speed (s)", "min": 3, "max": 10, "default": 5 },
    { "type": "checkbox", "id": "show_arrows", "label": "Show Arrows on Hover", "default": true },
    { "type": "checkbox", "id": "show_close", "label": "Show Close Button", "default": false },

    {
      "type": "header",
      "content": "Theme"
    },
    { "type": "color_scheme", "id": "color_scheme", "label": "Color Palette", "default": "default" }
  ],
  "blocks": [{ "type": "_announcement" }],
  "presets": [
    {
      "name": "Announcement Bar",
      "blocks": {
        "msg1": { "type": "_announcement", "settings": { "text": "Reserve Now" } },
        "msg2": { "type": "_announcement", "settings": { "text": "Live Music Friday" } }
      },
      "block_order": ["msg1", "msg2"]
    }
  ]
}
{% endschema %}
