{% assign s = section.settings %}
{% assign menu = shop.menu_data | map: s.menu %}

<section
  class="section-menu-list w-full color-{{ s.color_scheme }}"
  style="padding-top: {{ s.padding_top }}px; padding-bottom: {{ s.padding_bottom }}px;"
>
  <div class="wrapper">
    <div class="text-center max-w-3xl mx-auto mb-16 animate-fade-up">
      {% if s.heading != blank %}
        {% render 'typography', text: s.heading, tag: 'h2', size: 'display', color: 'var(--color-text)' %}
      {% else %}
        {% render 'typography', text: menu.name, tag: 'h2', size: 'display', color: 'var(--color-text)' %}
      {% endif %}

      {% if s.subtext != blank %}
        <div class="opacity-80 mt-4">
          {% render 'typography', text: s.subtext, tag: 'div', size: 'body', color: 'var(--color-text)' %}
        </div>
      {% endif %}
    </div>

    <div class="flex flex-col lg:flex-row gap-12">
      {% if s.display_scope == 'full_menu' %}
        {% assign all_categories = menu.categories | map_values | sort: 'display_order' %}
        {% assign root_categories = all_categories | where: 'parent_uuid', null %}

        {% if s.show_nav and root_categories.size > 1 %}
          <div class="hidden lg:block w-64 flex-shrink-0">
            <nav class="sticky top-32 flex flex-col gap-2 border-l-2 border-[var(--color-text)]/10 pl-4">
              {% for parent in root_categories %}
                <a
                  href="#cat-{{ parent.uuid }}"
                  class="text-sm font-bold opacity-50 hover:opacity-100 transition-opacity uppercase tracking-wider"
                >
                  {{ parent.name }}
                </a>
              {% endfor %}
            </nav>
          </div>
        {% endif %}

        <div class="flex-grow flex flex-col gap-20">
          {% for parent in root_categories %}
            <div id="cat-{{ parent.uuid }}" class="scroll-mt-32 menu-category-group">
              <div class="flex items-end justify-between border-b-2 border-[var(--color-text)] mb-8 pb-2">
                <h3 class="font-heading text-3xl font-bold uppercase tracking-wide">{{ parent.name }}</h3>
              </div>

              {% assign parent_items = parent.items | sort: 'display_order' %}
              {% if parent_items.size > 0 %}
                <div class="grid grid-cols-1 {% if s.columns == 2 %}md:grid-cols-2 gap-x-12{% endif %} gap-y-8 mb-12">
                  {% for item in parent_items %}
                    {% render 'menu-item-list', item: item %}
                  {% endfor %}
                </div>
              {% endif %}

              {% assign children = all_categories | where: 'parent_uuid', parent.uuid %}
              {% for child in children %}
                <div class="mb-12 pl-0 md:pl-4">
                  <h4 class="font-heading text-xl font-bold mb-6 opacity-80">{{ child.name }}</h4>
                  <div class="grid grid-cols-1 {% if s.columns == 2 %}md:grid-cols-2 gap-x-12{% endif %} gap-y-8">
                    {% assign child_items = child.items | sort: 'display_order' %}
                    {% for item in child_items %}
                      {% render 'menu-item-list', item: item %}
                    {% endfor %}
                  </div>
                </div>
              {% endfor %}
            </div>
          {% endfor %}
        </div>

      {% elsif s.display_scope == 'category' %}
        {% assign target_category = menu.categories | map_values | where: 'name', s.category_filter | first %}

        <div class="w-full flex-grow">
          {% if target_category %}
            <div class="grid grid-cols-1 {% if s.columns == 2 %}md:grid-cols-2 gap-x-12{% endif %} gap-y-8">
              {% assign sorted_items = target_category.items | sort: 'display_order' %}
              {% for item in sorted_items %}
                {% render 'menu-item-list', item: item %}
              {% endfor %}
            </div>
          {% else %}
            <div class="text-center opacity-50 py-12">
              Category "{{ s.category_filter }}" not found in menu "{{ menu.name }}".
            </div>
          {% endif %}
        </div>
      {% endif %}
    </div>

    {% if s.footer_text != blank %}
      <div class="w-full text-center mt-16 opacity-60 text-xs uppercase tracking-widest">
        {{ s.footer_text }}
      </div>
    {% endif %}
  </div>
</section>

{% schema %}
{
  "name": "Menu (List View)",
  "settings": [
    { "type": "header", "content": "Data Source" },
    { "type": "collection", "id": "menu", "label": "Select Menu" },
    {
      "type": "select",
      "id": "display_scope",
      "label": "Display Scope",
      "options": [
        { "value": "full_menu", "label": "Full Menu (All Categories)" },
        { "value": "category", "label": "Specific Category Only" }
      ],
      "default": "full_menu"
    },
    {
      "type": "text",
      "id": "category_filter",
      "label": "Category Name",
      "info": "Exact name of the category (e.g. 'Starters'). Used if Scope is Category."
    },

    { "type": "header", "content": "Layout" },
    {
      "type": "checkbox",
      "id": "show_nav",
      "label": "Show Sticky Navigation",
      "default": true,
      "info": "Only active in Full Menu mode."
    },
    {
      "type": "range",
      "id": "columns",
      "label": "Columns per Category",
      "min": 1,
      "max": 2,
      "default": 1
    },

    { "type": "header", "content": "Content" },
    { "type": "text", "id": "heading", "label": "Section Heading", "info": "Overrides Menu Name if set" },
    { "type": "textarea", "id": "subtext", "label": "Description" },
    {
      "type": "text",
      "id": "footer_text",
      "label": "Footer Note",
      "default": "* Consuming raw ingredients may increase risk."
    },

    { "type": "header", "content": "Spacing" },
    { "type": "range", "id": "padding_top", "label": "Top Padding", "min": 0, "max": 160, "step": 4, "default": 96 },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Bottom Padding",
      "min": 0,
      "max": 160,
      "step": 4,
      "default": 96
    },

    { "type": "header", "content": "Theme" },
    { "type": "color_scheme", "id": "color_scheme", "label": "Color Palette", "default": "scheme-1" }
  ],
  "presets": [{ "name": "Menu (List View)" }]
}
{% endschema %}
