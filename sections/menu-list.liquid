{% assign s = section.settings %}
{% assign menu = shop.menu_data | map: s.menu %}

{% assign categories_to_render = menu.categories | map_values %}

{% if s.display_scope == 'category' and s.category_filter != blank %}
  {% assign categories_to_render = menu.categories | where: 'name', s.category_filter | map_values %}
{% endif %}

<section
  class="section-menu-list w-full color-{{ s.color_scheme }}"
  style="padding-top: {{ s.padding_top }}px; padding-bottom: {{ s.padding_bottom }}px;"
>
  <div class="wrapper">
    {% if s.heading != blank %}
      <div class="text-center max-w-3xl mx-auto mb-16 animate-fade-up">
        {% render 'typography', text: s.heading, tag: 'h2', size: 'display', color: 'var(--color-text)' %}
        {% if s.subtext != blank %}
          <div class="opacity-80 mt-4">
            {% render 'typography', text: s.subtext, tag: 'div', size: 'body', color: 'var(--color-text)' %}
          </div>
        {% endif %}
      </div>
    {% endif %}

    <div class="flex flex-col lg:flex-row gap-12">
      {% if s.show_nav and s.display_scope == 'full_menu' and categories_to_render.size > 1 %}
        <div class="hidden lg:block w-64 flex-shrink-0">
          <div class="sticky top-32 flex flex-col gap-2 border-l-2 border-[var(--color-text)]/10 pl-4">
            {% for category in categories_to_render %}
              <a
                href="#cat-{{ category.uuid }}"
                class="text-sm font-bold opacity-50 hover:opacity-100 transition-opacity"
              >
                {{ category.name }}
              </a>
            {% endfor %}
          </div>
        </div>
      {% endif %}

      <div class="flex-grow flex flex-col gap-16">
        {% for category in categories_to_render %}
          <div id="cat-{{ category.uuid }}" class="scroll-mt-32">
            <div class="flex items-end justify-between border-b-2 border-[var(--color-text)] mb-8 pb-2">
              <h3 class="font-heading text-2xl font-bold uppercase tracking-wide">{{ category.name }}</h3>
            </div>

            <div class="grid grid-cols-1 {% if s.columns == 2 %}md:grid-cols-2 gap-x-12{% endif %} gap-y-8">
              {% for item in category.items %}
                {% render 'menu-item-list', item: item %}
              {% endfor %}
            </div>
          </div>

        {% else %}
          <div class="py-12 text-center opacity-60">
            <p>Category "{{ s.category_filter }}" not found in this menu.</p>
          </div>
        {% endfor %}
      </div>
    </div>

    {% if s.footer_text != blank %}
      <div class="w-full text-center mt-16 opacity-60 text-xs uppercase tracking-widest">
        {{ s.footer_text }}
      </div>
    {% endif %}
  </div>
</section>

{% schema %}
{
  "name": "Menu (List View)",
  "settings": [
    { "type": "header", "content": "Data Source" },
    { "type": "collection", "id": "menu", "label": "Select Menu" },
    {
      "type": "select",
      "id": "display_scope",
      "label": "Display Scope",
      "options": [
        { "value": "full_menu", "label": "Full Menu (All Categories)" },
        { "value": "category", "label": "Specific Category Only" }
      ],
      "default": "full_menu"
    },
    {
      "type": "text",
      "id": "category_filter",
      "label": "Category Name",
      "info": "Exact name of the category to display (e.g. 'Starters'). Only used if Scope is 'Specific Category'.",
      "visible_if": "{{ display_scope == 'category' }}"
    },

    { "type": "header", "content": "Content" },
    { "type": "text", "id": "heading", "label": "Section Heading", "default": "Our Menu" },
    { "type": "textarea", "id": "subtext", "label": "Description" },
    {
      "type": "text",
      "id": "footer_text",
      "label": "Footer Note",
      "default": "* Consuming raw ingredients may increase risk."
    },

    { "type": "header", "content": "Layout" },
    { "type": "checkbox", "id": "show_nav", "label": "Show Sticky Navigation", "default": true },
    {
      "type": "range",
      "id": "columns",
      "label": "Columns per Category",
      "min": 1,
      "max": 2,
      "default": 1
    },

    { "type": "header", "content": "Spacing" },
    { "type": "range", "id": "padding_top", "label": "Top Padding", "min": 0, "max": 160, "step": 4, "default": 96 },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Bottom Padding",
      "min": 0,
      "max": 160,
      "step": 4,
      "default": 96
    },

    { "type": "header", "content": "Theme" },
    { "type": "color_scheme", "id": "color_scheme", "label": "Color Palette", "default": "scheme-1" }
  ],
  "presets": [{ "name": "Menu (List View)" }]
}
{% endschema %}
