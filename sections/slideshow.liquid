{% assign s = section.settings %}

<div
  class="section-slideshow relative w-full overflow-hidden bg-gray-900 group select-none color-{{ s.color_scheme }}"
  data-behavior="slideshow"
  data-autoplay="{{ s.autoplay }}"
  data-speed="{{ s.autoplay_speed }}"
  data-infinite="{{ s.infinite_scroll }}"
>
  <div class="slideshow-track flex w-full overflow-x-auto snap-x snap-mandatory scroll-smooth scrollbar-hide {{ s.mobile_height }} {{ s.desktop_height }} cursor-grab active:cursor-grabbing">
    {% content_for 'blocks' %}
  </div>

  {% if section.blocks.size > 1 %}
    {% if s.show_arrows %}
      {% assign arrow_pos_class = 'absolute top-1/2 -translate-y-1/2 z-floating px-4 w-full flex justify-between pointer-events-none' %}
      {% if s.nav_position == 'bottom_right' %}
        {% assign arrow_pos_class = 'absolute bottom-8 right-8 z-floating flex gap-2' %}
      {% endif %}

      <div class="{{ arrow_pos_class }}">
        <button
          type="button"
          class="slideshow-prev pointer-events-auto p-3 rounded-full bg-[var(--color-ui-bg)] text-[var(--color-ui-text)] shadow-lg hover:scale-105 transition-all disabled:opacity-50"
          aria-label="Previous"
        >
          {% render 'icon', name: s.arrow_icon, class: 'w-5 h-5' %}
        </button>

        <button
          type="button"
          class="slideshow-next pointer-events-auto p-3 rounded-full bg-[var(--color-ui-bg)] text-[var(--color-ui-text)] shadow-lg hover:scale-105 transition-all disabled:opacity-50"
          aria-label="Next"
        >
          {% assign icon_name = s.arrow_icon | replace: '-left', '-right' %}
          {% render 'icon', name: icon_name, class: 'w-5 h-5' %}
        </button>
      </div>
    {% endif %}

    {% if s.show_dots %}
      {% assign nav_pos_class = 'absolute bottom-6 left-1/2 -translate-x-1/2' %}
      {% if s.nav_position == 'bottom_left' %} {% assign nav_pos_class = 'absolute bottom-8 left-8' %} {% endif %}
      {% if s.nav_position == 'bottom_right' %} {% assign nav_pos_class = 'absolute bottom-8 right-8' %} {% endif %}

      <div class="{{ nav_pos_class }} z-floating flex items-center gap-3">
        {% for block in section.blocks %}
          <button
            type="button"
            class="slideshow-dot transition-all duration-300"
            data-index="{{ forloop.index0 }}"
            aria-label="Go to slide {{ forloop.index }}"
          >
            {% if s.dot_style == 'dots' %}
              <span
                class="block w-2.5 h-2.5 rounded-full bg-[var(--color-ui-bg)] opacity-50 hover:opacity-100 ring-1 ring-transparent"
              ></span>
            {% elsif s.dot_style == 'bars' %}
              <span class="block w-8 h-1 rounded-sm bg-[var(--color-ui-bg)] opacity-50 hover:opacity-100"></span>
            {% elsif s.dot_style == 'numbers' %}
              <span class="text-sm font-bold text-[var(--color-ui-text)] opacity-50">{{ forloop.index }}</span>
            {% endif %}
          </button>
        {% endfor %}
      </div>
    {% endif %}
  {% endif %}
</div>

{% stylesheet %}
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  /* Active States */
  /* 1. Dots and Bars get full opacity and scale */
  .slideshow-dot.is-active span {
    opacity: 1;
    transform: scale(1.2);
    background-color: var(--color-ui-bg);
  }

  /* 2. Numbers need text color change, not background */
  .slideshow-dot.is-active span.text-sm {
    opacity: 1;
    background-color: transparent; /* Reset bg for numbers */
    color: var(--color-ui-bg); /* Highlight number */
  }

  /* 3. Focus Ring (Accessibility/Visuals) */
  .slideshow-dot.is-active span.ring-1 {
    ring-color: var(--color-ui-text);
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Slideshow",
  "settings": [
    { "type": "header", "content": "Layout" },
    {
      "type": "select",
      "id": "mobile_height",
      "label": "Mobile Height",
      "options": [
        { "value": "h-[50vh]", "label": "Compact (50%)" },
        { "value": "h-[65vh]", "label": "Standard (65%)" },
        { "value": "h-[80vh]", "label": "Tall (80%)" },
        { "value": "h-screen", "label": "Full Screen" }
      ],
      "default": "h-[65vh]"
    },
    {
      "type": "select",
      "id": "desktop_height",
      "label": "Desktop Height",
      "options": [
        { "value": "md:h-[500px]", "label": "Compact (500px)" },
        { "value": "md:h-[75vh]", "label": "Standard (75%)" },
        { "value": "md:h-screen", "label": "Full Screen" }
      ],
      "default": "md:h-[75vh]"
    },

    { "type": "header", "content": "Controls" },
    { "type": "checkbox", "id": "show_arrows", "label": "Show Arrows", "default": true },
    { "type": "checkbox", "id": "show_dots", "label": "Show Pagination", "default": true },
    {
      "type": "select",
      "id": "dot_style",
      "label": "Pagination Style",
      "options": [
        { "value": "dots", "label": "Dots" },
        { "value": "bars", "label": "Bars" },
        { "value": "numbers", "label": "Numbers" }
      ],
      "default": "dots"
    },
    {
      "type": "select",
      "id": "arrow_icon",
      "label": "Arrow Style",
      "options": [
        { "value": "chevron-left", "label": "Chevron" },
        { "value": "arrow-left", "label": "Arrow" }
      ],
      "default": "chevron-left"
    },
    {
      "type": "select",
      "id": "nav_position",
      "label": "Controls Position",
      "options": [
        { "value": "middle_sides", "label": "Middle Sides (Arrows Only)" },
        { "value": "bottom_center", "label": "Bottom Center" },
        { "value": "bottom_left", "label": "Bottom Left" },
        { "value": "bottom_right", "label": "Bottom Right" }
      ],
      "default": "middle_sides"
    },
    { "type": "header", "content": "Theme" },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color Palette",
      "default": "scheme-1",
      "info": "Controls the color of arrows and dots."
    },
    { "type": "header", "content": "Behavior" },
    { "type": "checkbox", "id": "infinite_scroll", "label": "Infinite Loop", "default": true },
    { "type": "checkbox", "id": "autoplay", "label": "Autoplay", "default": false },
    { "type": "range", "id": "autoplay_speed", "label": "Speed (seconds)", "min": 3, "max": 10, "default": 5 }
  ],
  "blocks": [{ "type": "slide" }],
  "presets": [
    {
      "name": "Slideshow (Gallery)",
      "settings": {
        "mobile_height": "h-[65vh]",
        "desktop_height": "md:h-[75vh]",
        "show_arrows": true,
        "show_dots": true
      },
      "blocks": {
        "slide_1": {
          "type": "slide",
          "settings": { "align_x": "items-center", "align_y": "justify-center", "color_scheme": "scheme-1" },
          "blocks": {
            "heading": { "type": "jumbo-text", "settings": { "text": "Welcome", "display_size": "display" } },
            "btn": { "type": "button", "settings": { "label": "View Menu", "style": "primary" } }
          },
          "block_order": ["heading", "btn"]
        }
      },
      "block_order": ["slide_1"]
    }
  ]
}
{% endschema %}
