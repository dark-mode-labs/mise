{% assign s = section.settings %}

{% capture section_spacing_style %}
  {% if s.height == 'custom' %}--max-h: {{ s.height_custom }}px;{% endif %}
{% endcapture %}

{% capture section_spacing_class %}
  section-h-{{ s.height }}
{% endcapture %}

<section
  class="section-slideshow relative overflow-hidden bg-surface group select-none color-{{ s.color_scheme }} width-{{ s.width_scheme }} {{ section_spacing_class }} limit-width px-0"
  data-behavior="slideshow"
  data-autoplay="{{ s.autoplay }}"
  data-speed="{{ s.autoplay_speed }}"
  data-infinite="{{ s.infinite_scroll }}"
  style="
    --slide-width: {{ s.slide_width_mobile }}%;
    --slide-width-md: {{ s.slide_width }}%;
    --slide-gap: {{ s.slide_gap }}px;
    {{ section_spacing_style }}
  "
>
  <div class="slideshow-track flex h-full w-full overflow-x-auto snap-x snap-mandatory scroll-smooth scrollbar-hide cursor-grab active:cursor-grabbing gap-[var(--slide-gap)]">
    {% content_for 'blocks' %}
  </div>

  {% if section.blocks.size > 1 %}
    {% if s.show_arrows %}
      {% assign arrow_pos_class = 'absolute top-1/2 -translate-y-1/2 z-floating px-4 w-full flex justify-between pointer-events-none' %}
      {% if s.nav_position == 'bottom_right' %}
        {% assign arrow_pos_class = 'absolute bottom-8 right-8 z-floating flex gap-2' %}
      {% endif %}

      <div class="{{ arrow_pos_class }}">
        <button type="button" class="slideshow-prev pointer-events-auto p-3 rounded-full btn-nav" aria-label="Previous">
          {% render 'icon', name: s.arrow_icon, class: 'w-5 h-5' %}
        </button>

        <button type="button" class="slideshow-next pointer-events-auto p-3 rounded-full btn-nav" aria-label="Next">
          {% assign icon_name = s.arrow_icon | replace: '-left', '-right' %}
          {% render 'icon', name: icon_name, class: 'w-5 h-5' %}
        </button>
      </div>
    {% endif %}

    {% if s.show_dots %}
      {% assign nav_pos_class = 'absolute bottom-6 left-1/2 -translate-x-1/2' %}
      {% if s.nav_position == 'bottom_left' %} {% assign nav_pos_class = 'absolute bottom-8 left-8' %} {% endif %}
      {% if s.nav_position == 'bottom_right' %} {% assign nav_pos_class = 'absolute bottom-8 right-8' %} {% endif %}

      <div class="{{ nav_pos_class }} z-floating flex items-center gap-3">
        {% for block in section.blocks %}
          <button
            type="button"
            class="slideshow-dot transition-all duration-300"
            data-index="{{ forloop.index0 }}"
            aria-label="Go to slide {{ forloop.index }}"
          >
            {% if s.dot_style == 'dots' %}
              <span
                class="block w-2.5 h-2.5 rounded-full bg-[var(--color-ui-bg)] opacity-50 hover:opacity-100 ring-1 ring-transparent"
              ></span>
            {% elsif s.dot_style == 'bars' %}
              <span class="block w-8 h-1 rounded-sm bg-[var(--color-ui-bg)] opacity-50 hover:opacity-100"></span>
            {% elsif s.dot_style == 'numbers' %}
              <span class="text-sm font-bold text-[var(--color-ui-text)] opacity-50">{{ forloop.index }}</span>
            {% endif %}
          </button>
        {% endfor %}
      </div>
    {% endif %}
  {% endif %}
</section>

{% schema %}
{
  "name": "Slideshow",
  "settings": [
    { "type": "header", "content": "Layout" },
    {
      "type": "width_scheme",
      "id": "width_scheme",
      "label": "Max Content Width",
      "default": "standard"
    },
    {
      "type": "select",
      "id": "height",
      "label": "Section Height",
      "options": [
        { "value": "sm", "label": "Small" },
        { "value": "md", "label": "Medium" },
        { "value": "lg", "label": "Large" },
        { "value": "xl", "label": "Fullscreen" },
        { "value": "custom", "label": "Custom" }
      ],
      "default": "md"
    },
    {
      "type": "range",
      "id": "slide_gap",
      "label": "Gap between slides",
      "min": 0,
      "max": 40,
      "step": 4,
      "default": 0,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "Peeking / Sizing"
    },
    {
      "type": "range",
      "id": "slide_width",
      "label": "Slide Width (Desktop)",
      "min": 80,
      "max": 100,
      "step": 5,
      "default": 100,
      "unit": "%",
      "info": "Set to < 100% to show part of the next slide."
    },
    {
      "type": "range",
      "id": "slide_width_mobile",
      "label": "Slide Width (Mobile)",
      "min": 80,
      "max": 100,
      "step": 5,
      "default": 100,
      "unit": "%"
    },

    { "type": "header", "content": "Controls" },
    { "type": "checkbox", "id": "show_arrows", "label": "Show Arrows", "default": true },
    { "type": "checkbox", "id": "show_dots", "label": "Show Pagination", "default": true },
    {
      "type": "select",
      "id": "dot_style",
      "label": "Pagination Style",
      "options": [
        { "value": "dots", "label": "Dots" },
        { "value": "bars", "label": "Bars" },
        { "value": "numbers", "label": "Numbers" }
      ],
      "default": "dots",
      "conditional": "setting.show_dots"
    },
    {
      "type": "select",
      "id": "arrow_icon",
      "label": "Arrow Style",
      "options": [
        { "value": "chevron-left", "label": "Chevron" },
        { "value": "arrow-left", "label": "Arrow" }
      ],
      "default": "chevron-left",
      "conditional": "setting.show_arrows",
      "info": "Controls are middle sides."
    },
    {
      "type": "select",
      "id": "nav_position",
      "label": "Controls Position",
      "options": [
        { "value": "bottom_center", "label": "Bottom Center" },
        { "value": "bottom_left", "label": "Bottom Left" },
        { "value": "bottom_right", "label": "Bottom Right" }
      ],
      "default": "bottom_center",
      "conditional": "setting.show_dots"
    },
    { "type": "header", "content": "Theme" },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color Palette",
      "default": "default",
      "info": "Controls the color of arrows and dots."
    },
    { "type": "header", "content": "Behavior" },
    { "type": "checkbox", "id": "infinite_scroll", "label": "Infinite Loop", "default": true },
    { "type": "checkbox", "id": "autoplay", "label": "Autoplay", "default": false },
    {
      "type": "range",
      "id": "autoplay_speed",
      "label": "Speed (seconds)",
      "min": 3,
      "max": 10,
      "default": 5,
      "conditional": "setting.autoplay == true"
    }
  ],
  "blocks": [{ "type": "_slide" }],
  "presets": [
    {
      "name": "Slideshow (Gallery)",
      "settings": {
        "mobile_height": "h-[65vh]",
        "desktop_height": "md:h-[75vh]",
        "show_arrows": true,
        "show_dots": true
      },
      "blocks": {
        "slide_1": {
          "type": "_slide",
          "blocks": {
            "heading": { "type": "jumbo-text", "settings": { "text": "Welcome", "display_size": "display" } },
            "btn": { "type": "button", "settings": { "label": "View Menu", "style": "primary" } }
          },
          "block_order": ["heading", "btn"]
        }
      },
      "block_order": ["slide_1"]
    }
  ]
}
{% endschema %}
