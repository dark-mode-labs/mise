{% assign s = block.settings %}

<nav class="header-nav hidden lg:flex items-center h-full">
  <ul class="flex items-center gap-8 h-full">
    {% for link in s.menu.links %}
      {% assign has_mega = false %}
      {% if link.levels > 1 %}{% assign has_mega = true %}{% endif %}

      <li class="group h-full flex items-center relative">
        <a
          href="{{ link.url }}"
          class="text-sm font-bold uppercase tracking-wide hover:opacity-70 flex items-center gap-1 h-full"
        >
          {{ link.title }}
          {% if link.links != blank %}
            {% render 'icon',
              name: 'chevron-down',
              class: 'w-3 h-3 opacity-50 group-hover:rotate-180 transition-transform'
            %}
          {% endif %}
        </a>

        {% if link.links != blank %}
          <div
            class="
              absolute top-full left-0 border border-std shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-floating
              {% if has_mega %}!fixed left-0 right-0 w-full border-x-0{% else %}w-64{% endif %}
            "
          >
            {% if has_mega %}
              <div class="mx-auto px-8 py-12 grid grid-cols-4 gap-8">
                {% for child in link.links %}
                  <div>
                    <a
                      href="{{ child.url }}"
                      class="block font-heading font-bold text-lg mb-4 hover:underline underline-offset-4"
                    >
                      {{ child.title }}
                    </a>
                    <ul class="space-y-2">
                      {% for grandchild in child.links %}
                        <li>
                          <a href="{{ grandchild.url }}" class="text-sm opacity-70 hover:opacity-100 block">
                            {{ grandchild.title }}
                          </a>
                        </li>
                      {% endfor %}
                    </ul>
                  </div>
                {% endfor %}

                {% if s.show_promo %}
                  <div class="col-span-1 bg-gray-50/5 p-6 rounded-global border border-std">
                    {% if s.promo_image %}
                      <div class="mb-4 rounded-global overflow-hidden">
                        {% render 'media', src: s.promo_image, ratio: 'landscape', fit: 'cover' %}
                      </div>
                    {% endif %}
                    {% if s.promo_heading != blank %}
                      <h4 class="font-bold mb-1">{{ s.promo_heading }}</h4>
                    {% endif %}
                    {% if s.promo_text != blank %}
                      <p class="text-sm opacity-70">{{ s.promo_text }}</p>
                    {% endif %}
                  </div>
                {% endif %}
              </div>

            {% else %}
              <ul class="py-4">
                {% for child in link.links %}
                  <li>
                    <a href="{{ child.url }}" class="block px-6 py-2 text-sm hover:bg-gray-50/5 whitespace-nowrap">
                      {{ child.title }}
                    </a>
                  </li>
                {% endfor %}
              </ul>
            {% endif %}
          </div>
        {% endif %}
      </li>
    {% endfor %}
  </ul>
</nav>

{% render 'header-drawer', menu: s.menu %}

{% schema %}
{
  "name": "Header Nav",
  "settings": [
    {
      "type": "link_list",
      "id": "menu",
      "label": "Menu",
      "default": "main-menu"
    },
    {
      "type": "header",
      "content": "Mega Menu Promo"
    },
    {
      "type": "checkbox",
      "id": "show_promo",
      "label": "Show Promo Block",
      "default": false,
      "info": "Appears on the right side of multi-column menus."
    },
    {
      "type": "image_picker",
      "id": "promo_image",
      "label": "Promo Image"
    },
    {
      "type": "text",
      "id": "promo_heading",
      "label": "Promo Heading",
      "default": "Featured"
    },
    {
      "type": "text",
      "id": "promo_text",
      "label": "Promo Text",
      "default": "Check out our new seasonal specials."
    }
  ]
}
{% endschema %}
