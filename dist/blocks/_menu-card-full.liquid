{% assign s = block.settings %}

{% capture block_classes %}
  group-block grid grid-rows-[auto_1fr_auto] relative transition-all rounded-global bg-surface
  text-align-{{ s.text_align }}
  width-{{ s.width }}
  height-{{ s.height }}
  section-py-{{ s.padding_vertical }}
  section-px-{{ s.padding_horizontal }}
  gap-{{ s.gap }}

  {% unless s.inherit_styles %}color-{{ s.color_scheme | default: 'none' }}{% endunless %}

  {% if s.shadow %}shadow-lg{% endif %}
  {% if s.overflow_hidden %}overflow-hidden{% endif %}
  {% if s.enable_glass %}backdrop-blur-md bg-opacity-80 border border-white/10{% endif %}
{% endcapture %}

{% capture block_styles %}
  {% if s.padding_vertical == 'custom' %}
    --space-py: {{ s.padding_vertical_custom }}px;
  {% endif %}
  {% if s.padding_horizontal == 'custom' %}
     --space-px: {{ s.padding_horizontal_custom }}px;
  {% endif %}
  {% if s.gap == 'custom' %}
    --space-gap: {{ s.gap_custom }}px;
  {% endif %}

  {% unless s.inherit_styles %}
    {% if s.border_radius_override %}
      --radius-global: {{ s.border_radius }}px;
    {% endif %}
    {% if s.bg_color_override %}
      --color-surface: {{ s.bg_color }};
    {% endif %}
    {% if s.shadow_color_override %}
      --color-shadow: {{ s.shadow_color_custom }}
    {% endif %}
  {% endunless %}

  {% if s.opacity < 100 %}opacity: {{ s.opacity | divided_by: 100.0 }};{% endif %}
{% endcapture %}

<div
  class="{{ block_classes }}"
  style="{{ block_styles }}"
  {{ context.attached_attributes }}
>
  {% content_for 'block', type: 'group', id: 'menu-card-header' %}
  {% content_for 'block', type: 'group', id: 'menu-card-content' %}
  {% content_for 'block', type: 'group', id: 'menu-card-footer' %}
</div>

{% schema %}
{
  "name": "Menu Card",
  "settings": [
    { "type": "header", "content": "Layout Mode" },
    {
      "type": "range",
      "id": "min_column_width",
      "label": "Min Item Width (Grid Only)",
      "min": 100,
      "max": 500,
      "step": 10,
      "default": 250,
      "unit": "px"
    },
    { "type": "header", "content": "General Styles" },
    {
      "type": "select",
      "id": "text_align",
      "label": "Text Alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ],
      "default": "left"
    },
    {
      "type": "select",
      "id": "width",
      "label": "Width",
      "options": [
        { "value": "full", "label": "Full Width" },
        { "value": "fit", "label": "Fit Content" }
      ],
      "default": "full"
    },
    {
      "type": "select",
      "id": "height",
      "label": "Height",
      "options": [
        { "value": "auto", "label": "Auto" },
        { "value": "full", "label": "Full Height" }
      ],
      "default": "auto"
    },
    {
      "type": "select",
      "id": "padding_vertical",
      "label": "Vertical Padding",
      "options": [
        { "value": "none", "label": "None" },
        { "value": "xs", "label": "XS" },
        { "value": "sm", "label": "Small" },
        { "value": "md", "label": "Medium" },
        { "value": "lg", "label": "Large" },
        { "value": "xl", "label": "XL" },
        { "value": "custom", "label": "Custom" }
      ],
      "default": "none"
    },
    {
      "type": "range",
      "id": "padding_vertical_custom",
      "label": "Custom V-Padding",
      "min": 0,
      "max": 128,
      "step": 4,
      "default": 0,
      "conditional": "setting.padding_vertical == 'custom'"
    },
    {
      "type": "select",
      "id": "padding_horizontal",
      "label": "Horizontal Padding",
      "options": [
        { "value": "none", "label": "None" },
        { "value": "xs", "label": "XS" },
        { "value": "sm", "label": "Small" },
        { "value": "md", "label": "Medium" },
        { "value": "lg", "label": "Large" },
        { "value": "xl", "label": "XL" },
        { "value": "custom", "label": "Custom" }
      ],
      "default": "none"
    },
    {
      "type": "range",
      "id": "padding_horizontal_custom",
      "label": "Custom H-Padding",
      "min": 0,
      "max": 128,
      "step": 4,
      "default": 0,
      "conditional": "setting.padding_horizontal == 'custom'"
    },
    {
      "type": "select",
      "id": "gap",
      "label": "Gap",
      "options": [
        { "value": "none", "label": "None" },
        { "value": "xs", "label": "XS" },
        { "value": "sm", "label": "Small" },
        { "value": "md", "label": "Medium" },
        { "value": "lg", "label": "Large" },
        { "value": "xl", "label": "XL" },
        { "value": "custom", "label": "Custom" }
      ],
      "default": "none"
    },
    {
      "type": "range",
      "id": "gap_custom",
      "label": "Custom Gap",
      "min": 0,
      "max": 100,
      "step": 4,
      "default": 16,
      "conditional": "setting.gap == 'custom'"
    },
    {
      "type": "header",
      "content": "Style"
    },
    { "type": "checkbox", "id": "shadow", "label": "Show Shadow", "default": false },
    { "type": "checkbox", "id": "enable_glass", "label": "Glass Effect", "default": false },
    { "type": "checkbox", "id": "overflow_hidden", "label": "Clip Content", "default": true },
    { "type": "range", "id": "opacity", "min": 0, "max": 100, "label": "Opacity", "default": 100 },
    { "type": "checkbox", "id": "inherit_styles", "label": "Inherit Theme Styles", "default": true },
    {
      "type": "header",
      "content": "Overrides",
      "conditional": "setting.inherit_styles != true"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color Scheme",
      "default": "default",
      "conditional": "setting.inherit_styles != true"
    },
    {
      "type": "checkbox",
      "id": "bg_color_override",
      "label": "Override Background",
      "default": false,
      "conditional": "setting.inherit_styles != true"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Custom Background",
      "conditional": "setting.inherit_styles != true and setting.bg_color_override"
    },
    {
      "type": "checkbox",
      "id": "border_radius_override",
      "label": "Override Border Radius",
      "default": false,
      "conditional": "setting.inherit_styles != true"
    },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 60,
      "label": "Radius",
      "default": 0,
      "unit": "px",
      "conditional": "setting.inherit_styles != true and setting.border_radius_override"
    },
    {
      "type": "checkbox",
      "id": "shadow_color_override",
      "label": "Override Shadow Color",
      "default": false,
      "conditional": "setting.inherit_styles != true"
    },
    {
      "type": "color",
      "id": "shadow_color_custom",
      "label": "Custom Shadow Color",
      "default": "rgba(0,0,0,1)",
      "conditional": "setting.inherit_styles != true and setting.shadow_color_override"
    }
  ],
  "presets": [
    {
      "name": "full-menu-card",
      "blocks": {
        "menu-card-header": {
          "type": "group",
          "name": "Heading",
          "static": true,
          "settings": {
            "gap": "none",
            "padding_vertical": "none",
            "padding_horizontal": "none"
          },
          "blocks": {
            "img": {
              "type": "media",
              "settings": {
                "image": "{{ context.item.asset.url }}",
                "placeholder": "scene-1",
                "object_fit": "cover",
                "aspect_ratio": "landscape"
              }
            }
          },
          "block_order": ["img"]
        },
        "menu-card-content": {
          "type": "group",
          "name": "Content",
          "static": true,
          "settings": {
            "gap": "sm",
            "padding_vertical": "xs",
            "padding_horizontal": "md"
          },
          "blocks": {
            "desc": {
              "type": "text",
              "settings": {
                "content": "{{ context.item.description }}",
                "text_align": "left",
                "display_size": "caption",
                "text_transform": "none"
              }
            },
            "info": {
              "type": "group",
              "blocks": {
                "price": {
                  "type": "text",
                  "settings": {
                    "tag": "span",
                    "content": "{{ context.item.amount | money }}",
                    "text_align": "right",
                    "font_weight": "bold",
                    "display_size": "body"
                  }
                },
                "title": {
                  "type": "text",
                  "settings": {
                    "tag": "h3",
                    "content": "{{ context.item.name }}",
                    "text_wrap": "balance",
                    "text_align": "left",
                    "font_weight": "bold",
                    "display_size": "body"
                  }
                }
              },
              "settings": {
                "gap": "xs",
                "width": "full",
                "direction": "row",
                "content_align": "between",
                "vertical_align": "top",
                "padding_vertical": "xs",
                "padding_horizontal": "none"
              },
              "block_order": ["title", "price"]
            }
          },
          "block_order": ["info", "desc"]
        },
        "menu-card-footer": {
          "type": "group",
          "name": "Footer",
          "static": true,
          "settings": {
            "gap": "xs",
            "padding_vertical": "xs",
            "padding_horizontal": "md"
          },
          "blocks": {
            "btn": {
              "type": "button",
              "settings": {
                "label": "Order Now",
                "width": "full"
              }
            }
          },
          "block_order": ["btn"]
        }
      },
      "settings": {
        "gap": "none",
        "shadow": true
      }
    }
  ]
}
{% endschema %}
