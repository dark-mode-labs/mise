{% comment %}
  Props:
  - src, src_mobile, video
  - ratio, fit, loading, placeholder
  - animate: (Boolean) Enables Ken Burns slow zoom. Default: false.
{% endcomment %}

{% assign fit_mode = fit | default: 'cover' %}
{% assign load_mode = loading | default: 'lazy' %}
{% assign anim_class = '' %}

{% if animate %}
  {% assign anim_class = 'animate-ken-burns' %}
{% endif %}

{% capture ratio_class %}
  {% case ratio %}
    {% when 'square' %}aspect-square
    {% when 'video' %}aspect-video
    {% when 'portrait' %}aspect-[3/4]
    {% when 'landscape' %}aspect-[4/3]
    {% else %}h-full
  {% endcase %}
{% endcapture %}

<div class="media-wrapper w-full {{ ratio_class }} overflow-hidden relative bg-gray-100">

  {% if video != blank %}
    <video 
      autoplay muted loop playsinline 
      class="w-full h-full object-{{ fit_mode }} pointer-events-none {{ anim_class }}"
      {% if src %}poster="{{ src | image_url: width: 800 }}"{% endif %}>
      <source src="{{ video }}" type="video/mp4">
    </video>

  {% elsif src != blank %}
    {% if src_mobile != blank %}
      <picture class="w-full h-full block {{ anim_class }}">
        <source media="(max-width: 767px)" srcset="{{ src_mobile | image_url: width: 800 }}">
        <source media="(min-width: 768px)" srcset="{{ src | image_url: width: 1600 }}">
        <img 
          src="{{ src | image_url: width: 1600 }}" 
          alt="{{ src.alt | escape }}"
          loading="{{ load_mode }}"
          width="{{ src.width }}"
          height="{{ src.height }}"
          class="w-full h-full object-{{ fit_mode }} block transition-opacity duration-500"
        >
      </picture>
    {% else %}
      <img 
        src="{{ src | image_url: width: 1600 }}" 
        alt="{{ src.alt | escape }}"
        loading="{{ load_mode }}"
        width="{{ src.width }}"
        height="{{ src.height }}"
        class="w-full h-full object-{{ fit_mode }} block transition-opacity duration-500 {{ anim_class }}"
      >
    {% endif %}

  {% else %}
    {% comment %} Even placeholders get to dance {% endcomment %}
    <div class="w-full h-full {{ anim_class }}">
      {{ placeholder | default: 'lifestyle-1' | placeholder_svg_tag: 'w-full h-full object-cover text-gray-300 bg-gray-100 fill-current' }}
    </div>
  {% endif %}

</div>