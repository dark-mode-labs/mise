{% comment %}
  Props:
  - src: (Image object) Desktop Image
  - src_mobile: (Image object) Mobile Image (Optional)
  - video: (String) URL to MP4 (Optional - Overrides images)
  - ratio: (String) 'square', 'video', 'portrait', 'auto' (Default: 'auto' / fill)
  - fit: (String) 'cover' or 'contain' (Default: 'cover')
  - placeholder: (String) Name of the svg placeholder to use if src is missing (Default: 'image')
  - loading: (String) 'lazy' or 'eager' (Default: 'lazy')
{% endcomment %}

{% assign fit_mode = fit | default: 'cover' %}
{% assign load_mode = loading | default: 'lazy' %}

{% comment %} 1. Aspect Ratio Logic {% endcomment %}
{% capture ratio_class %}
  {% case ratio %}
    {% when 'square' %}aspect-square
    {% when 'video' %}aspect-video
    {% when 'portrait' %}aspect-[3/4]
    {% when 'landscape' %}aspect-[4/3]
    {% else %}h-full
  {% endcase %}
{% endcapture %}

<div class="media-wrapper w-full {{ ratio_class }} overflow-hidden relative bg-gray-100">

  {% if video != blank %}
    {% comment %} --- VIDEO MODE --- {% endcomment %}
    <video 
      autoplay muted loop playsinline 
      class="w-full h-full object-{{ fit_mode }} pointer-events-none"
      {% if src %}poster="{{ src | image_url: width: 800 }}"{% endif %}>
      <source src="{{ video }}" type="video/mp4">
    </video>

  {% elsif src != blank %}
    {% comment %} --- IMAGE MODE (With Art Direction) --- {% endcomment %}
    {% if src_mobile != blank %}
      <picture class="w-full h-full block">
        <source media="(max-width: 767px)" srcset="{{ src_mobile | image_url: width: 800 }}">
        <source media="(min-width: 768px)" srcset="{{ src | image_url: width: 1600 }}">
        <img 
          src="{{ src | image_url: width: 1600 }}" 
          alt="{{ src.alt | escape }}"
          loading="{{ load_mode }}"
          width="{{ src.width }}"
          height="{{ src.height }}"
          class="w-full h-full object-{{ fit_mode }} block transition-opacity duration-500"
        >
      </picture>
    {% else %}
      <img 
        src="{{ src | image_url: width: 1600 }}" 
        alt="{{ src.alt | escape }}"
        loading="{{ load_mode }}"
        width="{{ src.width }}"
        height="{{ src.height }}"
        class="w-full h-full object-{{ fit_mode }} block transition-opacity duration-500"
      >
    {% endif %}

  {% else %}
    {% comment %} --- PLACEHOLDER FALLBACK --- {% endcomment %}
    {{ placeholder | default: 'lifestyle-1' | placeholder_svg_tag: 'w-full h-full object-cover text-gray-300 bg-gray-100 fill-current' }}
  {% endif %}

</div>